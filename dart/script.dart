import "dart:html" as h;import "dart:js" as z;import "dart:async" as KB;class AB{static const String BB="Chrome";static const String CB="Firefox";static const String DB="Internet Explorer";static const String EB="Safari";final String t;final String minimumVersion;const AB(this.t,[this.minimumVersion]);}class FB{const FB();}class GB{final String name;const GB(this.name);}class HB{const HB();}class IB{const IB();}class q{void u(){LB();MB();NB();OB();PB();QB();RB();SB();}void LB(){h.Element e=h.querySelector('.close-jumbotron-button');h.Element f=h.querySelector('.open-jumbotron-button');if(e==null||f==null){return;}h.Element b=h.querySelector('.jumbotron');h.Element c=h.querySelector('.jumbotron-folded');e.onClick.listen((d){b.style.display='none';c.style.display='block';o('closeJumbotron','1',expires:180);d.stopPropagation();});f.onClick.listen((d){b.style.display='block';c.style.display='none';o('closeJumbotron','0',expires:180);d.stopPropagation();});if(s('closeJumbotron')=='1'){b.style.display='none';c.style.display='block';}}void MB(){h.Element d=h.querySelector('.navbar-toggle-button');h.Element b=h.querySelector('.navbar-collapsible-block');bool c=false;var e=(TB){if(c){b.classes..add('in')..remove('collapse')..remove('collapsing');}else{b.classes..add('collapse')..remove('collapsing')..remove('in');b.style.height='0';}};b.onTransitionEnd.listen(e);d.onClick.listen((g){c=!c;b.classes..add('collapsing')..remove('collapse')..remove('in');if(c){int f=b.scrollHeight+1;b.style.height="${f}px";}else{b.style.height="0";}});}void NB(){List<h.Node> f=h.document.getElementsByTagName('span');DateTime g=new DateTime.now();Duration i=g.timeZoneOffset;List<String> j=const['Понедельник','Вторник','Среда','Четверг','Пятница','Суббота','Воскресенье'];List<String> k=const['января','февраля','марта','апреля','мая','июня','июля','августа','сентября','октября','ноября','декабря'];f.forEach((h.Element c){String d=c.dataset['postDate'];if(d==null){return;}DateTime e=DateTime.parse(d);if(e==null){return;}DateTime b=e.add(i);c.text="${j[b.weekday-1]}, ${b.day} ${k[b.month-1]} ${b.year}" ", ${b.hour<10?'0':''}${b.hour}:${b.minute<10?'0':''}${b.minute}";});}void OB(){h.ElementList c=h.querySelectorAll('span.post-comments');if(c.length==0){return;}new KB.Timer.periodic(new Duration(microseconds:100),(g){if(c[0].text.startsWith('Считаем')){return;}g.cancel();c.forEach((h.Element i){h.Element d=i.querySelector('a');if(d==null){return;}d.text=d.text.replaceAllMapped(new RegExp('^(\\d+) комментариев\$'),(Match f){int b=int.parse(f[1]);if((b%100/10).round()!=1){int e=b%10;if(e==1){return '${b} комментарий';}else if(e>=2&&e<=4){return '${b} комментария';}}return f[0];});});});}void PB(){if(UB()){VB();}}bool UB(){final h.NodeValidatorBuilder WB=new h.NodeValidatorBuilder.common()..allowElement('span',attributes:['data-linenum']);h.ElementList j=h.querySelectorAll('pre > code.sourceCode');if(j.length>0){z.JsObject l=z.context['hljs'];j.forEach((h.HtmlElement e){l.callMethod('highlightBlock',[e]);List<String> c=e.innerHtml.split('\n');RegExp m=new RegExp(r'<span[\s\S]*?>');RegExp v=new RegExp(r'</span>');List<String> f=[] ;for(int b=0;b<c.length; ++b){String d='<span class="line" data-linenum="${b+1}">';if(c[b]==''){d+= '&nbsp;';}else{String g=f.join('')+c[b];d+= g;Iterable<Match> k=m.allMatches(g);Iterable<Match> w=v.allMatches(g);f=[] ;for(int i=w.length;i<k.length; ++i){f.add(k.elementAt(i).group(0));d+= '</span>';}}d+= '</span>';c[b]=d;}e.setInnerHtml(c.join('\n'),validator:WB);e.classes.add('highlighted');});return true;}else{return false;}}void VB(){h.Element f=new h.DivElement()..classes.add('tooltip-inner');h.Element b=new h.DivElement()..append(new h.DivElement()..classes.add('tooltip-arrow'))..append(f)..classes.addAll(['tooltip','left','fade']);b.classes.add(h.CssStyleDeclaration.supportsTransitions?'out':'in');b.style.display='none';h.document.body.append(b);b.onTransitionEnd.listen((h.TransitionEvent d){if(b.classes.contains('out')){b.style.display='none';}});void i(){if(!h.CssStyleDeclaration.supportsTransitions){b.style.display='none';}else{b.classes..remove('in')..add('out');}}void j(k){b.style..visibility='hidden'..display='block';b.style..left="${k.offsetLeft-b.clientWidth}px"..top="${k.offsetTop-2}px"..visibility="visible";if(h.CssStyleDeclaration.supportsTransitions){b.classes..remove('out')..add('in');}}h.Element c;bool e=false;var g=h.querySelectorAll('span.line');g.onClick.listen((h.MouseEvent d){if(c==d.currentTarget){if(!e){e=true;return;}i();c=null;e=false;return;}e=true;c=d.currentTarget;f.text='#'+c.getAttribute('data-linenum');j(c);});g.onMouseMove.listen((h.MouseEvent d){if(e||c==d.currentTarget){return;}c=d.currentTarget;f.text='#'+c.getAttribute('data-linenum');j(c);});g.onMouseOut.listen((h.MouseEvent d){if(e||c!=d.currentTarget){return;}i();c=null;});}void QB(){var e=h.querySelectorAll('.note-link');if(e.length==0){return;}h.Element f=new h.HeadingElement.h3()..classes.add('popover-title');h.DivElement g=new h.DivElement()..classes.add('popover-content');h.Element b=new h.DivElement()..append(new h.DivElement()..classes.add('arrow'))..append(f)..append(g)..classes.addAll(['popover','top','fade']);b.classes.add(h.CssStyleDeclaration.supportsTransitions?'out':'in');b.style.display='none';h.document.body.append(b);b.onTransitionEnd.listen((h.TransitionEvent i){if(b.classes.contains('out')){b.style.display='none';}});var d;final h.NodeValidatorBuilder WB=new h.NodeValidatorBuilder.common()..allowNavigation(new JB());e.onClick.listen((h.MouseEvent i){var c=i.currentTarget;if(d==c){if(!h.CssStyleDeclaration.supportsTransitions){b.style.display='none';}else{b.classes..remove('in')..add('out');}d=null;return;}f.text="Примечание ${c.text}";var j=h.querySelector('.footnotes li[data-for=${c.id}]');if(j==null){return;}g.setInnerHtml(j.innerHtml,validator:WB);d=c;b.style..visibility='hidden'..display='block';b.style..left="${c.offsetLeft+(c.clientWidth-b.clientWidth)/2+2}px"..top="${c.offsetTop-b.clientHeight}px"..visibility="visible";if(h.CssStyleDeclaration.supportsTransitions){b.classes..remove('out')..add('in');}});}void RB(){h.Element b=h.querySelector('.pager .previous');h.Element c=h.querySelector('.pager .next');bool f=h.window.navigator.platform.indexOf('Mac')!=-1;if(b!=null){b.attributes['title']+=" (${f?'⌥←':'Ctrl + ←'})";}if(c!=null){c.attributes['title']+=" (${f?'⌥→':'Ctrl + →'})";}if(b!=null||c!=null){h.document.onKeyDown.listen((h.KeyboardEvent d){if(d.altKey||d.ctrlKey){h.Element e;if(d.keyCode==h.KeyCode.LEFT){e=b;}else if(d.keyCode==h.KeyCode.RIGHT){e=c;}if(e!=null){h.window.location.replace(e.querySelector('a').getAttribute('href'));}}});}}void SB(){if(h.querySelectorAll('span.math').length>0){h.Element b=new h.ScriptElement()..type="text/javascript"..async=true..src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML";h.document.body.append(b);}}}class JB implements h.UriPolicy{bool allowsUri(String b){return true;}}void main(){q b=new q();b.u();}String n(b)=>Uri.decodeComponent(b.replaceAll(r"\+",' '));String r(DateTime f){var g=['Mon','Tue','Wed','Thi','Fri','Sat','Sun'];var i=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];var XB=(int c,int j){var d=c.toString();var e=j-d.length;return (e>0)?'${new List.filled(e,'0').join('')}${c}':d;};var b=f.toUtc();var k=XB(b.hour,2);var l=XB(b.minute,2);var m=XB(b.second,2);return '${g[b.weekday-1]}, ${b.day} ${i[b.month-1]} ${b.year} '+'${k}:${l}:${m} ${b.timeZoneName}';}String s(String e){var i=new Map();var d=h.document.cookie!=null?h.document.cookie.split('; '):[] ;for(var b=0,f=d.length;b<f;b++ ){var c=d[b].split('=');var g=n(c[0]);if(e==g){return c[1]!=null?n(c[1]):null;}}return null;}void o(String b,String c,{expires,path,domain,secure}){if(expires is num){expires=new DateTime.fromMillisecondsSinceEpoch(new DateTime.now().millisecondsSinceEpoch+expires*24*60*60*1000);}var d=([Uri.encodeComponent(b),'=',Uri.encodeComponent(c),expires!=null?'; expires='+r(expires):'',path!=null?'; path='+path:'',domain!=null?'; domain='+domain:'',secure!=null&&secure==true?'; secure':''].join(''));h.document.cookie=d;}