import "dart:js";import "dart:html";import "dart:math";import "dart:convert";import "dart:async";const yB='mangledGlobalNames';const zB='mangledNames';const AC='metadata';const BC='getIsolateTag';class WB{static const String CC="Chrome";static const String DC="Firefox";static const String EC="Internet Explorer";static const String FC="Opera";static const String GC="Safari";final String pB;final String minimumVersion;const WB(this.pB,[this.minimumVersion]);}class XB{const XB();}class YB{final String name;const YB(this.name);}class ZB{const ZB();}class aB{const aB();}class MB{void KB(){HC();IC();JC();KC();LC();MC();NC();OC();PC();}void HC(){StyleElement g=new StyleElement();g.type='text/css';document.head.append(g);final CssStyleSheet i=g.sheet as CssStyleSheet;var h=window.innerHeight-querySelector('.navbar').clientHeight-60;if(h<200){h=200;}final j='.img-responsive, .thumbnail>img, .thumbnail a>img, .post-body .figure .figure-inner>img, ' '.post-body .figure .figure-inner a>img { max-height: ${h}px; }';i.insertRule(j,0);}void IC(){Element j=querySelector('.close-jumbotron-button');Element k=querySelector('.open-jumbotron-button');if(j==null||k==null){return;}Element g=querySelector('.jumbotron');Element h=querySelector('.jumbotron-folded');j.onClick.listen((i){g.style.display='none';h.style.display='block';QB('closeJumbotron','1',expires:180);i.stopPropagation();});k.onClick.listen((i){g.style.display='block';h.style.display='none';QB('closeJumbotron','0',expires:180);i.stopPropagation();});if(dB('closeJumbotron')=='1'){g.style.display='none';h.style.display='block';}}void JC(){Element i=querySelector('.navbar-toggle-button');Element g=querySelector('.navbar-collapsible-block');bool h=false;var j=(l){if(h){g.classes..add('in')..remove('collapse')..remove('collapsing');}else{g.classes..add('collapse')..remove('collapsing')..remove('in');g.style.height='0';}};g.onTransitionEnd.listen(j);i.onClick.listen((m){h=!h;g.classes..add('collapsing')..remove('collapse')..remove('in');if(h){int k=g.scrollHeight+1;g.style.height="${k}px";}else{g.style.height="0";}});}void KC(){List<Node> k=document.getElementsByTagName('span');DateTime l=new DateTime.now();Duration m=l.timeZoneOffset;List<String> n=const['Понедельник','Вторник','Среда','Четверг','Пятница','Суббота','Воскресенье'];List<String> o=const['января','февраля','марта','апреля','мая','июня','июля','августа','сентября','октября','ноября','декабря'];k.forEach((Element h){String i=h.dataset['postDate'];if(i==null){return;}DateTime j=DateTime.parse(i);if(j==null){return;}DateTime g=j.add(m);h.text="${n[g.weekday-1]}, ${g.day} ${o[g.month-1]} ${g.year}" ", ${g.hour<10?'0':''}${g.hour}:${g.minute<10?'0':''}${g.minute}";});}void LC(){ElementList h=querySelectorAll('span.post-comments');if(h.length==0){return;}new Timer.periodic(new Duration(microseconds:100),(l){if(h[0].text.startsWith('Считаем')){return;}l.cancel();h.forEach((Element m){Element i=m.querySelector('a');if(i==null){return;}i.text=i.text.replaceAllMapped(new RegExp('^(\\d+) комментариев\$'),(Match k){int g=int.parse(k[1]);if((g%100/10).round()!=1){int j=g%10;if(j==1){return '${g} комментарий';}else if(j>=2&&j<=4){return '${g} комментария';}}return k[0];});});});}void MC(){if(QC()){RC();}}bool QC(){final NodeValidatorBuilder u=new NodeValidatorBuilder.common()..allowElement('span',attributes:['data-linenum']);ElementList n=querySelectorAll('pre > code.sourceCode');if(n.length>0){JsObject v=context['hljs'];n.forEach((HtmlElement j){v.callMethod('highlightBlock',[j]);List<String> h=j.innerHtml.split('\n');RegExp AB=new RegExp(r'<span[\s\S]*?>');RegExp CB=new RegExp(r'</span>');List<String> k=[] ;for(int g=0;g<h.length; ++g){String i='<span class="line" data-linenum="${g+1}">';if(h[g]==''){i+= '&nbsp;';}else{String l=k.join('')+h[g];i+= l;Iterable<Match> o=AB.allMatches(l);Iterable<Match> DB=CB.allMatches(l);k=[] ;for(int m=DB.length;m<o.length; ++m){k.add(o.elementAt(m).group(0));i+= '</span>';}}i+= '</span>';h[g]=i;}j.setInnerHtml(h.join('\n'),validator:u);j.classes.add('highlighted');});return true;}else{return false;}}void RC(){Element k=new DivElement()..classes.add('tooltip-inner');Element g=new DivElement()..append(new DivElement()..classes.add('tooltip-arrow'))..append(k)..classes.addAll(['tooltip','left','fade']);g.classes.add(CssStyleDeclaration.supportsTransitions?'out':'in');g.style.display='none';document.body.append(g);g.onTransitionEnd.listen((TransitionEvent i){if(g.classes.contains('out')){g.style.display='none';}});void m(){if(!CssStyleDeclaration.supportsTransitions){g.style.display='none';}else{g.classes..remove('in')..add('out');}}void n(o){g.style..visibility='hidden'..display='block';g.style..left="${o.offsetLeft-g.clientWidth}px"..top="${o.offsetTop-2}px"..visibility="visible";if(CssStyleDeclaration.supportsTransitions){g.classes..remove('out')..add('in');}}Element h;bool j=false;var l=querySelectorAll('span.line');l.onClick.listen((MouseEvent i){if(h==i.currentTarget){if(!j){j=true;return;}m();h=null;j=false;return;}j=true;h=i.currentTarget;k.text='#'+h.getAttribute('data-linenum');n(h);});l.onMouseMove.listen((MouseEvent i){if(j||h==i.currentTarget){return;}h=i.currentTarget;k.text='#'+h.getAttribute('data-linenum');n(h);});l.onMouseOut.listen((MouseEvent i){if(j||h!=i.currentTarget){return;}m();h=null;});}void NC(){var j=querySelectorAll('.note-link');if(j.length==0){return;}Element k=new HeadingElement.h3()..classes.add('popover-title');DivElement l=new DivElement()..classes.add('popover-content');Element g=new DivElement()..append(new DivElement()..classes.add('arrow'))..append(k)..append(l)..classes.addAll(['popover','top','fade']);g.classes.add(CssStyleDeclaration.supportsTransitions?'out':'in');g.style.display='none';document.body.append(g);g.onTransitionEnd.listen((TransitionEvent m){if(g.classes.contains('out')){g.style.display='none';}});var i;final NodeValidatorBuilder o=new NodeValidatorBuilder.common()..allowNavigation(new bB());j.onClick.listen((MouseEvent m){var h=m.currentTarget;if(i==h){if(!CssStyleDeclaration.supportsTransitions){g.style.display='none';}else{g.classes..remove('in')..add('out');}i=null;return;}k.text="Примечание ${h.text}";var n=querySelector('.footnotes li[data-for=${h.id}]');if(n==null){return;}l.setInnerHtml(n.innerHtml,validator:o);i=h;g.style..visibility='hidden'..display='block';g.style..left="${h.offsetLeft+(h.clientWidth-g.clientWidth)/2+2}px"..top="${h.offsetTop-g.clientHeight}px"..visibility="visible";if(CssStyleDeclaration.supportsTransitions){g.classes..remove('out')..add('in');}});}void OC(){Element g=querySelector('.pager .previous');Element h=querySelector('.pager .next');bool k=window.navigator.platform.indexOf('Mac')!=-1;if(g!=null){g.attributes['title']+=" (${k?'⌥←':'Ctrl + ←'})";}if(h!=null){h.attributes['title']+=" (${k?'⌥→':'Ctrl + →'})";}if(g!=null||h!=null){document.onKeyDown.listen((KeyboardEvent i){if(i.altKey||i.ctrlKey){Element j;if(i.keyCode==KeyCode.LEFT){j=g;}else if(i.keyCode==KeyCode.RIGHT){j=h;}if(j!=null){window.location.replace(j.querySelector('a').getAttribute('href'));}}});}}void PC(){if(querySelectorAll('span.math').length>0){Element g=new ScriptElement()..type="text/javascript"..async=true..src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML";document.body.append(g);}}}class bB implements UriPolicy{bool allowsUri(String g){return true;}}class NB{static const String OB="/map";static const String IB="#ffffdd";static final Map<String,String> JB=<String,String>{'blue':'#a3cec5','green':'#d3e46f','orange':'#fdc663','pink':'#f3c1d3','purple':'#ceb5cf','red':'#fdaf6b','turquoise':'#aadb78','yellow':'#fae364'};num width;num height;JsObject svg;JsObject s;JsObject map;JsObject zoom;JsFunction LB;JsFunction path;Element BB;Element t;var GB;var q;List FB;void KB(){map=context['d3'].callMethod('select',['.map']);width=map.callMethod('property',['clientWidth']);height=width*0.57;zoom=context['d3']['behavior'].callMethod('zoom').callMethod('scaleExtent',[new JsObject.jsify([1,60])]).callMethod('size',[new JsObject.jsify([width,height])]).callMethod('on',["zoom",wB]);BB=new DivElement()..classes.addAll(['country-tooltip','hidden']);querySelector('.map').append(BB);t=querySelector('.popover.info');t.onClick.listen((h)=>HB());rB();HttpRequest.request('${OB}/world.json').then((HttpRequest g){var i=JSON.decode(g.responseText);HttpRequest.request('${OB}/data.json').then((HttpRequest g){var j=JSON.decode(g.responseText);initData(i,j);},onError:(h){window.alert("Error loading visited countries data");initData(i,{});});},onError:(h)=>window.alert("Error loading world data."));}void initData(g,i){q=i;GB=context['topojson'].callMethod('feature',[new JsObject.jsify(g),new JsObject.jsify(g['objects']['countries'])])['features'];var j=context['topojson'].callMethod('feature',[new JsObject.jsify(g),new JsObject.jsify(g['objects']['subunits'])])['features'];GB.addAll(j);var k=context['topojson'].callMethod('feature',[new JsObject.jsify(g),new JsObject.jsify(g['objects']['regions'])])['features'];GB.addAll(k);FB=[] ;q.forEach((l,h){if(h['cities']!=null){FB.addAll(h['cities']);}});tB();sB();uB();}void rB(){LB=context['d3']['geo']['polyhedron'].callMethod('waterman').callMethod('scale',[0.121841155*width]).callMethod('translate',[new JsObject.jsify([width/2,height/2])]).callMethod('rotate',[new JsObject.jsify([20,0])]);JsObject g=context['d3']['geo'].callMethod('graticule').callMethod('minorStep',[new JsObject.jsify([5,5])]);path=context['d3']['geo'].callMethod('path').callMethod('projection',[LB]).callMethod('pointRadius',[1]);svg=map.callMethod('append',['svg']).callMethod('attr',['width',width]).callMethod('attr',['height',height]).callMethod('call',[zoom]);JsObject h=svg.callMethod('append',['defs']).callMethod('append',['clipPath']).callMethod('attr',['id','outlineClipPath']);h.callMethod('append',['path']).callMethod('datum',[new JsObject.jsify({"type":"Sphere"})]).callMethod('attr',['class','graticule outline']).callMethod('attr',['d',path]);s=svg.callMethod('append',['g']).callMethod('style',['clip-path','url(#outlineClipPath)']);s.callMethod('append',['path']).callMethod('datum',[new JsObject.jsify({"type":"Sphere"})]).callMethod('attr',['class','background']).callMethod('attr',['d',path]).callMethod("on",["click",(i,j,[k])=>HB()]);s.callMethod('append',['path']).callMethod('datum',[g]).callMethod('attr',['class','graticule']).callMethod('attr',['d',path]);s.callMethod("style",["stroke-width",1]).callMethod('attr',["transform","translate(0,0)scale(1)"]);}void vB(){s.callMethod("append",['path']).callMethod("datum",[new JsObject.jsify({'type':"Sphere"})]).callMethod("attr",["class","graticule outline"]).callMethod("attr",["d",path]);}void tB(){JsObject j=s.callMethod("selectAll",[".country"]).callMethod("data",[GB]);j.callMethod("enter").callMethod("insert",["path"]).callMethod("attr",["class","country"]).callMethod("attr",["d",path]).callMethod("attr",["id",(h,k,[l])=>h['id']]).callMethod("style",["fill",(h,k,[l]){String i;String g=h['id'];if(g.length>3){i=g;g=g.substring(0,3);}var u=q[g];if(u==null){return IB;}var m=u['color'];if(m==null||JB[m]==null){return IB;}if(i!=null){if(q[g]['regions']!=null&&q[g]['regions'][i]!=null){return JB[m];}return IB;}return JB[m];}]);vB();num AB=map.callMethod("property",['offsetLeft'])+5;num CB=map.callMethod("property",['offsetTop'])-40;j.callMethod("on",["mousemove",(h,k,[l]){var n=context['d3'].callMethod("mouse",[svg.callMethod("node")]);var i;var g=h['id'];if(g.length>3){i=g;g=g.substring(0,3);}String o=qB(g,i);BB..classes.remove("hidden")..style.left="${n[0]+AB}px"..style.top="${n[1]+CB}px"..innerHtml=o;}]);j.callMethod("on",["mouseout",(h,k,[l])=>BB.classes.add('hidden')]);j.callMethod("on",["click",(h,k,[l]){var i;var g=h['id'];if(g.length>3){i=g;g=g.substring(0,3);}if(q[g]==null||q[g]['name']==null){HB();return;}String o=q[g]['name'];var n=context['d3'].callMethod("mouse",[svg.callMethod("node")]);List v=q[g]['cities'];v.sort((DB,UB)=>DB['name'].compareTo(UB['name']));Iterable VB=v.map((xB)=>"<li>${RB(xB)}</li>");TB(o,'<ul class="list-unstyled">${VB.join('')}</ul>',n);}]);}String qB(g,i){String h="Неизведанная территория";if(q[g]!=null&&q[g]['name']!=null){h=q[g]['name'];if(i!=null){if(q[g]['regions']!=null&&q[g]['regions'][i]!=null){h=q[g]['regions'][i]+' &mdash; '+h;}}}return h;}void sB(){var h=s.callMethod("selectAll",[".city"]).callMethod("data",[new JsObject.jsify(FB)]);h.callMethod("enter").callMethod("insert",["path"]).callMethod("attr",["class","city"]).callMethod("attr",["d",(g,j,[k])=>path.apply([new JsObject.jsify({"type":"Point","coordinates":[g['lon'],g['lat']]})])]);num l=map.callMethod("property",['offsetLeft'])+5;num m=map.callMethod("property",['offsetTop'])-40;h.callMethod("on",["mousemove",(g,j,[k]){var i=context['d3'].callMethod("mouse",[svg.callMethod("node")]);BB..classes.remove("hidden")..style.left="${i[0]+l}px"..style.top="${i[1]+m}px"..innerHtml=g['name'];}]);h.callMethod("on",["mouseout",(g,j,[k])=>BB.classes.add('hidden')]);h.callMethod("on",["click",(g,j,[k]){var i=context['d3'].callMethod("mouse",[svg.callMethod("node")]);TB(g['name'],"<p>${RB(g,true)}</p>",i);}]);}void uB(){num h=-1000000.0;num i=-1000000.0;num j=1000000.0;num k=1000000.0;FB.forEach((m){var l=LB.apply([new JsObject.jsify([m['lon'],m['lat']])]);h=max(h,l[0]);j=min(j,l[0]);i=max(i,l[1]);k=min(k,l[1]);});num g=0.95/max((h-j)/width,(i-k)/height);List<num> n=[-(j+h)/2*g+width/2,-(k+i)/2*g+height/2];path=path.callMethod("pointRadius",[max(1/4,1/g)]);var AB=s.callMethod("selectAll",['.city']);s.callMethod('transition').callMethod("duration",[5000]).callMethod("attr",["transform","translate(${n.join(',')})scale(${g})"]).callMethod("tween",["side-effects",(UB,VB,[CB]){var o=context['d3'].callMethod('interpolateNumber',[1,g]);return (DB){var u=o.apply([DB]);s.callMethod("style",["stroke-width",1/u]);path=path.callMethod("pointRadius",[max(1/4,1/u)]);AB.callMethod("attr",["d",(v,o,[CB])=>path.apply([new JsObject.jsify({"type":"Point","coordinates":[v['lon'],v['lat']]})])]);};}]);zoom.callMethod("translate",[new JsObject.jsify(n)]);zoom.callMethod("scale",[g]);}void wB([k,l,m]){JsObject i=context['d3']['event']['translate'];List<num> g=<num>[i[0],i[1]];num h=context['d3']['event']['scale'];g[0]=max(min(g[0],0),width*(1-h));g[1]=max(min(g[1],0),height*(1-h));path=path.callMethod("pointRadius",[max(1/4,1/h)]);zoom.callMethod("translate",[new JsObject.jsify(g)]);s.callMethod("style",["stroke-width",1/h]).callMethod("attr",["transform","translate(${g.join(',')})scale(${h})"]);s.callMethod("selectAll",['.city']).callMethod("attr",["d",(j,n,[o])=>path.apply([new JsObject.jsify({"type":"Point","coordinates":[j['lon'],j['lat']]})])]);HB();}void TB(String j,String k,h){num l=map.callMethod("property",['offsetLeft'])+5;num i=map.callMethod("property",['offsetTop'])-40;t.querySelector('.popover-title').innerHtml=j;t.querySelector('.popover-content').innerHtml=k;t.style.display='block';int m=t.clientWidth;int n=t.clientHeight;int g=h[1]+i-n+40;t.classes.toggle('top',g>=60);t.classes.toggle('bottom',g<60);if(g<60){g=h[1]+i+40;}t.style..left="${h[0]+l-m/2-3}px"..top="${g}px";}void HB(){t.style.display='none';}static final List<String> EB=<String>['январь','февраль','март','апрель','май','июнь','июль','август','сентябрь','октябрь','ноябрь','декабрь'];String SB(g){var h='';int i=g['yearFrom'];if(i==null){i=g['year'];if(i==null){i=g['yearTo'];}}int l=g['yearTo'];if(l==null){l=g['year'];if(l==null){l=g['yearFrom'];}}int j=g['monthFrom'];if(j==null){j=g['month'];if(j==null){j=g['monthTo'];}}int k=g['monthTo'];if(k==null){k=g['month'];if(k==null){k=g['monthFrom'];}}if(i!=null){if(i!=l){if(j!=null){h+= EB[j-1]+' ';}h+= "${i} &ndash; ";if(k!=null){h+= EB[k-1]+' ';}h+= l.toString();}else if(j!=null){h+= EB[j-1]+' ';if(j!=k){h+= '&ndash; ${EB[k-1]} ';}h+= i.toString();}else{h+= i.toString();}}if(h!=''){h='<small>${h}</small>';}return h;}String RB(g,[bool j=false]){if(g['visits']!=null&&g['visits'][0]!=null){String h=SB(g['visits'][0]);String i=(j?'':g['name'])+(h!=''?' '+h:'');if(g['visits'][0]['link']!=null){i='<a href="${g['visits'][0]['link']}">${i}</a>';}for(int k=1;k<g['visits'].length; ++k){var l=g['visits'][k];h=SB(l);if(h!=''){if(l['link']!=null){h='<a href="${l['link']}">${h}</a>';}i+= ", "+h;}}if(i==''&&j){i='<small>дата неизвестна</small>';}return i;}return j?'<small>дата неизвестна</small>':g['name'];}}void main(){MB g=new MB();g.KB();NB h=new NB();h.KB();}String PB(g)=>Uri.decodeComponent(g.replaceAll(r"\+",' '));String cB(DateTime l){var m=['Mon','Tue','Wed','Thi','Fri','Sat','Sun'];var n=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];var h=(int i,int o){var j=i.toString();var k=o-j.length;return (k>0)?'${new List.filled(k,'0').join('')}${i}':j;};var g=l.toUtc();var u=h(g.hour,2);var v=h(g.minute,2);var AB=h(g.second,2);return '${m[g.weekday-1]}, ${g.day} ${n[g.month-1]} ${g.year} '+'${u}:${v}:${AB} ${g.timeZoneName}';}String dB(String j){var m=new Map();var i=document.cookie!=null?document.cookie.split('; '):[] ;for(var g=0,k=i.length;g<k;g++ ){var h=i[g].split('=');var l=PB(h[0]);if(j==l){return h[1]!=null?PB(h[1]):null;}}return null;}void QB(String g,String h,{expires,path,domain,secure}){if(expires is num){expires=new DateTime.fromMillisecondsSinceEpoch(new DateTime.now().millisecondsSinceEpoch+expires*24*60*60*1000);}var i=([Uri.encodeComponent(g),'=',Uri.encodeComponent(h),expires!=null?'; expires='+cB(expires):'',path!=null?'; path='+path:'',domain!=null?'; domain='+domain:'',secure!=null&&secure==true?'; secure':''].join(''));document.cookie=i;}